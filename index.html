<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitration eBundling File Mapper</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Copy notification -->
    <div class="copy-notification" id="copyNotification">
        ‚úÖ Mapping exported to clipboard!
    </div>
    
    <div class="main-container">
        <!-- Header with stats -->
        <div class="header">
            <h1>üìã TERES File Mapper</h1>
            <div class="stats">
                <div class="stat-item">
                    Unmatched: <span class="stat-value" id="unmatchedCount">0</span>
                </div>
                <div class="stat-item">
                    Matched: <span class="stat-value" id="matchedCount">0</span>
                </div>
                <div class="stat-item">
                    Progress: <span class="stat-value" id="progressPercent">0%</span>
                </div>
            </div>
        </div>
        
        <!-- Left Panel: Unmatched References -->
        <div class="panel">
            <div class="unmatched-header">
                <h4>üîç Unmatched Refs</h4>
                <div class="multi-select-controls">
                    <input type="checkbox" class="select-all-checkbox" id="selectAllCheckbox" title="Select All">
                    <span class="selected-count" id="selectedCount">0 selected</span>
                </div>
            </div>
            
            <div class="bulk-actions hidden" id="bulkActions">
                <!-- Auto-matcher button will be added here by auto-matcher.js -->
                <button class="bulk-btn btn-secondary" id="bulkSkipBtn">‚è≠ Skip Selected</button>
                <button class="bulk-btn btn-secondary" id="bulkDeselectBtn">‚úï Deselect All</button>
                <div style="margin-left: auto;">
                    <button class="bulk-btn btn-secondary" id="detectRemainingBtn">üìÑ Detect Remaining Files</button>
                </div>
            </div>
            
            <div class="unmatched-list" id="unmatchedList">
                <!-- Unmatched references will be populated here -->
            </div>
        </div>
        
        <!-- Center Panel: Search & Results -->
        <div class="panel search-panel">
            <div class="current-reference" id="currentReference" style="display: none;">
                <h4>Currently Mapping:</h4>
                <div id="currentReferenceText"></div>
            </div>
            
            <input type="text" class="search-input" id="searchInput" placeholder="Search for matching file paths...">
            
            <div id="learningSuggestions" class="learning-suggestions-panel" style="display: none;"></div>

            <div class="search-results" id="searchResults">
                <div class="no-results">Select a file reference to start mapping</div>
            </div>
            
            <div class="action-buttons">
                <!-- NEW: Add a bulk confirm button, initially hidden -->
                <button class="btn btn-primary" id="confirmBulkMatchBtn" style="display: none;">
                    ‚úì Confirm Bulk Match (<span id="bulkMatchCount">0</span>)
                </button>
                <button class="btn btn-primary" id="confirmMatchBtn" disabled>‚úì Confirm Match</button>
                <button class="btn btn-secondary" id="skipBtn" disabled>‚è≠ Skip for Now</button>
            </div>
        </div>
        
        <!-- Right Panel: Matched Pairs -->
        <div class="panel">
            <h4>‚úÖ Matched Pairs</h4>
            <div class="matched-list" id="matchedList">
                <!-- Matched pairs will be populated here -->
            </div>
            
            <div class="export-section">
                <button class="btn btn-primary" id="exportBtn">üì§ Export Mappings</button>
            </div>
        </div>
    </div>


   <!-- Reharmonized Script Loading Order -->
    <script src="data-loader.js"></script>
    <script src="fuzzy-matcher.js"></script>
    <script src="workflow-manager.js"></script> 
    <script src="learning-engine.js"></script>
    <script src="fuzzy-matcher-manager.js"></script>
    <script src="virtual-scroller.js"></script>
    <script src="ui-manager.js"></script>
    <script src="export-manager.js"></script>
    <script src="import-export-manager.js"></script>
    <script src="cache-manager.js"></script>
    <script src="session-manager.js"></script>
    <script src="pattern-matcher.js"></script>
    <script src="auto-matcher.js"></script>
    <script src="app.js"></script>
</body>
</html>